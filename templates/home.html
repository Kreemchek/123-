{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* –°—Ç–∏–ª–∏ –∏–∑ variant_7.html */
    :root {
        --bg: #0b0d12;
        --bg-soft: #0f1218;
        --card: rgba(255,255,255,.05);
        --text: #e8ecf2;
        --muted: #b3b9c6;
        --brand: #7c66ff;
        --brand-2: #30d0ff;
        --accent: #ff6a3d;
        --ok: #51d67b;
        --warn: #ffba3b;
        --ring: 0 0 0 8px color-mix(in oklab, var(--brand) 22%, transparent);
        --radius: 20px;
        --shadow-1: 0 20px 60px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.06);
        --glow: 0 0 0 1px rgba(124,102,255,.2), 0 0 80px rgba(92,76,255,.25);
        --grid-gap: clamp(14px, 2vw, 20px);
    }
    @media (prefers-color-scheme: light) {
        :root {
            --bg: #f6f7fb;
            --bg-soft: #ffffff;
            --card: rgba(0,0,0,.04);
            --text: #0b1324;
            --muted: #5d6474;
            --shadow-1: 0 20px 60px rgba(18, 26, 44, .08), inset 0 1px 0 rgba(255,255,255,.8);
            --glow: 0 0 0 1px rgba(124,102,255,.15), 0 0 60px rgba(92,76,255,.15);
        }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
        margin: 0; background: radial-gradient(1200px 800px at 10% -10%, rgba(124,102,255,.18), transparent 60%), radial-gradient(1000px 600px at 90% 10%, rgba(48,208,255,.18), transparent 60%), var(--bg);
        color: var(--text); font: 16px/1.6 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        letter-spacing: .2px;
    }

    /* Topbar - —É–¥–∞–ª–µ–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ base.html */

    /* Hero */
    .hero .container {
        max-width: 1240px;
        margin: 0 auto;
        padding: 0 clamp(16px, 4vw, 28px);
    }
    .hero h1 { font-family: Manrope, Inter, system-ui, sans-serif; font-weight: 800; line-height: 1.1; font-size: clamp(28px, 3.6vw, 48px); margin: 0 0 12px; }
    .hero p { margin: 0 0 20px; color: var(--muted); font-size: clamp(14px, 1.4vw, 18px); }

    .searchbar { display:flex; align-items:center; gap:10px; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); padding: 12px; border-radius: 16px; border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow-1); }
    .searchbar input { flex:1; background: transparent; border: none; color: var(--text); padding: 14px 16px; font-size: 16px; outline: none; }
    .searchbar input::placeholder { color: var(--muted); }

  /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ */
    .quick {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: var(--grid-gap);
        margin-top: 20px;
    }

    .quick .card {
        position: relative;
        padding: 18px;
        border-radius: var(--radius);
        background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
        border: 1px solid rgba(255,255,255,.08);
        box-shadow: var(--shadow-1);
        overflow: hidden;
        text-decoration: none;
        transition: transform 0.25s ease;
        display: flex;
        flex-direction: column;
    }

    .quick .card:hover {
        transform: translateY(-2px);
    }

    .quick .card h3 {
        margin: 0 0 8px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        font-size: 18px;
        font-weight: 700;
        order: 1; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–¥–µ—Ç –ø–µ—Ä–≤—ã–º */
    }

    .quick .card p {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
        line-height: 1.4;
        order: 2; /* –û–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ—Ç –≤—Ç–æ—Ä—ã–º */
    }

    .quick .card::after {
        content: "";
        position: absolute;
        inset: auto -20px -20px auto;
        width: 120px;
        height: 120px;
        background: radial-gradient(60px 60px at 50% 50%, rgba(124,102,255,.35), transparent 60%);
        filter: blur(8px);
        z-index: 0;
    }

    .quick .card > * {
        position: relative;
        z-index: 1;
    }

    @media (max-width: 980px) {
        .quick {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 560px) {
        .quick {
            grid-template-columns: 1fr;
        }
    }

    /* Tabs (CSS-only) */
    .tabs { margin-top: 34px; }
    .tabs .tab-head { display:flex; gap:10px; flex-wrap: wrap; }
    .tabs input { position: absolute; opacity: 0; pointer-events: none; }
    .tabs label {
        padding: 12px 16px; border-radius: 14px; background: var(--card); border:1px solid rgba(255,255,255,.08);
        font-weight: 700; cursor: pointer; user-select: none; transition: .25s ease; display:inline-flex; align-items:center; gap:10px;
    }
    .tabs label:hover { transform: translateY(-1px); box-shadow: var(--shadow-1); }
    .tabs [type="radio"]:checked + label { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: #fff; box-shadow: var(--glow); }

    .tab-body { margin-top: 18px; }
    .panel { display: none; animation: rise .5s ease; }
    @keyframes rise { from { opacity:0; transform: translateY(6px); } to { opacity:1; transform: none; } }

    /* Radio control */
    #tab-brokers:checked ~ .tab-body #panel-brokers,
    #tab-objects:checked ~ .tab-body #panel-objects,
    #tab-developers:checked ~ .tab-body #panel-developers,
    #tab-media:checked ~ .tab-body #panel-media { display: block; }

    /* Cards Grid */
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: var(--grid-gap); }
    .col-3 { grid-column: span 3; }
    .col-4 { grid-column: span 4; }
    .col-6 { grid-column: span 6; }
    .col-12 { grid-column: span 12; }
    @media (max-width: 1100px) {
        .col-3 { grid-column: span 4; }
        .col-4 { grid-column: span 6; }
        .col-6 { grid-column: span 12; }
    }
    @media (max-width: 680px) {
        .col-3, .col-4 { grid-column: span 12; }
    }

    .card-spot {
        border-radius: var(--radius); overflow: hidden; position: relative; min-height: 190px; background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow-1);
    }
    .card-spot .media { position: absolute; inset: 0; background:
        radial-gradient(120px 120px at 80% -10%, rgba(48,208,255,.35), transparent 60%),
        radial-gradient(160px 160px at -10% 110%, rgba(124,102,255,.35), transparent 60%);
        opacity: .25; }
    .card-spot .content { position: relative; padding: 20px; display:flex; gap:16px; align-items: center; justify-content: space-between; }
    .pill { font-size: 12px; font-weight: 800; letter-spacing: .4px; padding: 8px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); }
    .hot { background: linear-gradient(135deg, var(--accent), #ff3d81); color: #fff; border: none; box-shadow: 0 10px 30px rgba(255,82,63,.25); }

/* –£–î–ê–õ–ò–¢–ï —Å—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è .listing-card .thumb */
/* .listing-card .thumb { aspect-ratio: 16/10; background: linear-gradient(180deg, rgba(124,102,255,.35), rgba(48,208,255,.25)); display:grid; place-items:center; font-weight:800; color:#fff; } */

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ */
.listing-card {
    position: relative;
    border-radius: 18px;
    border:1px solid rgba(255,255,255,.08);
    overflow: hidden;
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    box-shadow: var(--shadow-1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.listing-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--glow);
}

.listing-card .thumb {
    aspect-ratio: 16/10;
    position: relative;
    overflow: hidden;
    width: 100%;
}

.listing-card .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
}

.listing-card:hover .thumb img {
    transform: scale(1.05);
}

.listing-card .thumb > div {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 800;
    background: linear-gradient(135deg, rgba(124,102,255,.35), rgba(48,208,255,.25));
}

/* –ë–µ–π–¥–∂ "–ì–æ—Ä—è—á–µ–µ" - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è */
.hot-property-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: linear-gradient(45deg, #ff4d4d, #f95700);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 2;
}

.listing-card .body { padding: 16px; }
.meta { display:flex; flex-wrap: wrap; gap: 10px; color: var(--muted); font-size: 13px; }
.price { font-weight: 800; font-size: 18px; margin-left: auto; }
.card-actions { display:flex; gap:8px; margin-top:12px; }

    /* Media Section */
    .media-tabs { margin-top: 10px; }
    .media-tabs input { position: absolute; opacity:0; }
    .media-tabs label { padding: 10px 14px; border-radius: 12px; background: var(--card); border:1px solid rgba(255,255,255,.08); font-weight: 700; cursor: pointer; }
    .media-tabs [type="radio"]:checked + label { background: linear-gradient(135deg, var(--brand-2), var(--brand)); color:#fff; box-shadow: var(--glow); }

    #mtab-1:checked ~ .media-grid #mgrid-1,
    #mtab-2:checked ~ .media-grid #mgrid-2,
    #mtab-3:checked ~ .media-grid #mgrid-3 { display: grid; }

    .media-grid > .grid { display: none; }

    /* Media Section - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò */
.media-card {
    border-radius: 16px;
    overflow: hidden;
    border:1px solid rgba(255,255,255,.08);
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    box-shadow: var(--shadow-1);
}

.media-card .thumb {
    aspect-ratio: 16/9;
    position: relative;
    overflow: hidden; /* –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ */
    width: 100%; /* –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ */
}

.media-card .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block; /* –í–∞–∂–Ω–æ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∑–æ—Ä–æ–≤ */
}

    .media-card .body { padding: 14px 16px; }



    /* Utilities */
    .muted { color: var(--muted); }
    .hidden-sm { display: inline-flex; }
    @media (max-width:640px){ .hidden-sm { display:none; } }
    .link { text-decoration: none; color: inherit; }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è */
    #search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        z-index: 1000;
        border: 1px solid rgba(255,255,255,.08);
        border-top: none;
        background: var(--bg-soft);
        border-radius: 0 0 16px 16px;
        overflow: hidden;
    }
    #search-suggestions div {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255,255,255,.06);
        transition: background-color 0.2s ease;
    }
    #search-suggestions div:hover {
        background: rgba(255,255,255,.05);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
    #filters-modal {
        transition: opacity 0.3s ease;
        background: rgba(0,0,0,0.7);
    }
    #filters-modal > div {
        transition: transform 0.3s ease;
        background: var(--bg-soft);
        color: var(--text);
        border: 1px solid rgba(255,255,255,.08);
    }
    #filters-modal:not(.hidden) {
        display: flex;
        opacity: 1;
    }
    #filters-modal:not(.hidden) > div {
        transform: translateY(0);
    }

    #filters-modal select,
    #filters-modal input {
        background: var(--card);
        color: var(--text);
        border: 1px solid rgba(255,255,255,.08);
    }

    #filters-modal select:focus,
    #filters-modal input:focus {
        outline: none;
        border-color: var(--brand);
        box-shadow: 0 0 0 2px rgba(124,102,255,.2);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
    .toast {
        animation: slideIn 0.3s ease forwards;
        background: var(--bg-soft);
        color: var(--text);
        border: 1px solid rgba(255,255,255,.08);
    }
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

  

    .hot-property-card {
        border: 2px solid #ff4d4d;
        transition: all 0.3s ease;
    }

    .hot-property-card:hover {
        box-shadow: 0 10px 20px rgba(255, 77, 77, 0.2);
    }
    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ñ—É—Ç–µ—Ä–∞ –≤ home.html */
.home-page footer .container {
    max-width: 1024px !important;
    margin: 0 auto !important;
    padding: 0 1rem !important;
    width: 100% !important;
}

.home-page footer {
    justify-content: center !important;
    text-align: center !important;
}
  /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .btn {
        cursor: pointer;
        border: none;
        padding: 12px 16px;
        border-radius: 14px;
        font-weight: 700;
        transition: .25s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        color: #fff;
        box-shadow: var(--glow);
        border: none;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 0 1px rgba(124,102,255,.3), 0 0 100px rgba(92,76,255,.35);
    }

    .btn-ghost {
        background: var(--card);
        color: var(--text);
        border: 1px solid rgba(255,255,255,.08);
    }

    .btn-ghost:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-1);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫ "–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí" */
    .link strong {
        font-weight: 700;
        color: var(--text);
        transition: color 0.25s ease;
    }

    .link:hover strong {
        color: var(--brand);
    }
  /* –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–µ–∫—Ü–∏—é —Å—Ç–∏–ª–µ–π */
.thumb-overlay {
    position: absolute;
    bottom: 12px;
    right: 12px;
    background: rgba(0,0,0,.6);
    padding: 8px 12px;
    border-radius: 999px;
    font-size: 14px;
    color: white;
}

.media-card .thumb {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
}

.media-card .thumb img {
    transition: transform 0.3s ease;
}

.media-card:hover .thumb img {
    transform: scale(1.05);
}
.media-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: block;
    text-decoration: none;
    color: inherit;
}

.media-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--glow);
}

.link {
    text-decoration: none;
    color: inherit;
    display: block;
}
/* –û—Ç—Å—Ç—É–ø –¥–ª—è –º–µ–¥–∏–∞-–ø–∞–Ω–µ–ª–∏ */
#panel-media {
    margin-top: 20px;
}

/* –ò–ª–∏ –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–¥–∏–∞ */
.media-tabs {
    margin-top: 20px;
}

.media-grid {
    margin-top: 16px;
}
</style>

<!-- Hero -->
<section class="hero">
    <div class="container">
        <h1>–°–µ—Ä–≤–∏—Å –≤—ã–≥–æ–¥–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é</h1>
        <p>–ë–∞–∑–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>

        <form class="searchbar" role="search" id="search-form"
              action="{% if user.is_authenticated %}{% url 'properties:property-list' %}{% else %}{% url 'register' %}?next={% url 'properties:property-list' %}{% endif %}"
              method="get">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/><path d="M20 20L17 17" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
            <input type="text"
                   name="search"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥, –º–µ—Ç—Ä–æ, '2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è', '—Ü–µ–Ω–∞ 5-10 –º–ª–Ω', '—Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π'..."
                   class="flex-grow px-6 py-4 text-gray-800 border-0 focus:ring-4 focus:ring-blue-200/50 focus:outline-none placeholder-gray-500 text-lg"
                   id="location-search"
                   autocomplete="off">

            <button type="button" id="geolocation-btn"
                    class="text-gray-500 hover:text-blue-600 transition-colors duration-200 mr-2">
                <i class="fas fa-location-arrow text-lg"></i>
            </button>

            <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>

            <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ -->
            <input type="hidden" id="geo-coords" name="radius_filter">

            <div id="search-suggestions" class="hidden bg-white mt-2 rounded-xl shadow-lg z-10 max-h-60 overflow-auto border border-gray-200">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
            </div>
        </form>

        <div class="quick">
            <!-- –ë—Ä–æ–∫–µ—Ä—ã -->
            <a href="{% if user.is_authenticated %}{% url 'broker-list' %}{% else %}{% url 'register' %}?next={% url 'broker-list' %}{% endif %}" class="card link">
                <h3>–ë—Ä–æ–∫–µ—Ä—ã</h3>
                <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é</p>
            </a>

            <!-- –û–±—ä–µ–∫—Ç—ã -->
            <a href="{% if user.is_authenticated %}{% url 'properties:property-list' %}{% else %}{% url 'register' %}?next={% url 'properties:property-list' %}{% endif %}" class="card link">
                <h3>–û–±—ä–µ–∫—Ç—ã</h3>
                <p>–í—Å—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ</p>
            </a>

            <!-- –ó–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏ -->
            <a href="{% if user.is_authenticated %}{% url 'developer-list' %}{% else %}{% url 'register' %}?next={% url 'developer-list' %}{% endif %}" class="card link">
                <h3>–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏</h3>
                <p>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–æ–≤</p>
            </a>

            <!-- –ì–æ—Ä—è—á–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
            <a href="{% if user.is_authenticated %}{% url 'properties:property-list' %}?is_hot=true{% else %}{% url 'register' %}?next={% url 'properties:property-list' %}?is_hot=true{% endif %}" class="card link">
                <h3>üî• –ì–æ—Ä—è—á–∏–µ</h3>
                <p>–°–≤–µ–∂–∏–µ –∏ —Ä–µ–¥–∫–∏–µ –æ—Ñ—Ñ–µ—Ä—ã</p>
            </a>
        </div>

        <!-- Top tabs -->
        <div class="tabs">
            <input type="radio" name="tabs" id="tab-brokers" checked>
            <label for="tab-brokers">–ë—Ä–æ–∫–µ—Ä—ã</label>

            <input type="radio" name="tabs" id="tab-objects">
            <label for="tab-objects">–û–±—ä–µ–∫—Ç—ã</label>

            <input type="radio" name="tabs" id="tab-developers">
            <label for="tab-developers">–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏</label>

            <input type="radio" name="tabs" id="tab-media">
            <label for="tab-media">–ú–µ–¥–∏–∞</label>

            <div class="tab-body">
                <!-- Brokers Panel -->
                <div class="panel" id="panel-brokers">
                    <div class="grid">
                        <div class="col-6">
                            <div class="card-spot">
                                <div class="media"></div>
                                <div class="content">
                                    <div>
                                        <div class="pill">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä—Ç—ã</div>
                                        <h3 style="margin:8px 0 6px">–õ—É—á—à–∏–µ –±—Ä–æ–∫–µ—Ä—ã –≥–æ—Ä–æ–¥–∞</h3>
                                        <div class="muted">–†–µ–π—Ç–∏–Ω–≥, –æ—Ç–∑—ã–≤—ã, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</div>
                                    </div>
                                    <a href="{% if user.is_authenticated %}{% url 'broker-list' %}{% else %}{% url 'register' %}?next={% url 'broker-list' %}{% endif %}" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="grid">
                                {% for broker in featured_brokers|slice:":2" %}
                                <div class="col-6">
                                    <div class="listing-card">
                                        <div class="thumb">BROKER</div>
                                        <div class="body">
                                            <div style="display:flex; align-items:center; gap:10px;">
                                                <strong>{{ broker.user.get_full_name|default:broker.user.username }}</strong>
                                                <span class="pill">TOP 1%</span>
                                            </div>
                                            <div class="meta"><span>–û–ø—ã—Ç {{ broker.experience_years }} –ª–µ—Ç</span><span>{{ broker.completed_deals }}+ —Å–¥–µ–ª–æ–∫</span></div>
                                            <div class="card-actions">
                                                <a href="{% if user.is_authenticated %}{% url 'broker-detail' broker.id %}{% else %}{% url 'register' %}?next={% url 'broker-detail' broker.id %}{% endif %}" class="btn btn-ghost">–ü—Ä–æ—Ñ–∏–ª—å</a>
                                                <a href="{% if user.is_authenticated %}{% url 'broker-detail' broker.id %}#contact{% else %}{% url 'register' %}?next={% url 'broker-detail' broker.id %}#contact{% endif %}" class="btn btn-primary">–°–≤—è–∑–∞—Ç—å—Å—è</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

              <!-- Objects Panel -->
<!-- Objects Panel -->
<div class="panel" id="panel-objects">
    <div class="grid">
        <div class="col-12">
            <div class="card-spot">
                <div class="media"></div>
                <div class="content">
                    <div>
                        <div class="pill hot">üî• –ì–æ—Ä—è—á–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</div>
                        <h3 style="margin:8px 0 6px">–ü–æ–¥–±–æ—Ä–∫–∞ –Ω–µ–¥–µ–ª–∏</h3>
                        <div class="muted">–ö–≤–∞—Ä—Ç–∏—Ä—ã, —Å—Ç—É–¥–∏–∏ –∏ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã</div>
                    </div>
                    <a href="{% if user.is_authenticated %}{% url 'properties:property-list' %}?is_hot=true{% else %}{% url 'register' %}?next={% url 'properties:property-list' %}?is_hot=true{% endif %}" class="link"><strong>–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</strong></a>
                </div>
            </div>
        </div>

        <!-- 3 example listings -->
        {% for property in hot_properties|slice:":3" %}
        <div class="col-4">
            <div class="listing-card">
                <div class="thumb">
                    {% if property.images.all %}
                        <img src="{{ property.images.first.image.url }}" alt="{{ property.title }}">
                    {% else %}
                        <!-- –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                        <div>
                            {{ property.location }}
                        </div>
                    {% endif %}

                    <!-- –ë–µ–π–¥–∂ "–ì–æ—Ä—è—á–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" -->
                    {% if property.is_hot %}
                        <div class="hot-property-badge">üî• –ì–æ—Ä—è—á–µ–µ</div>
                    {% endif %}
                </div>
                <div class="body">
                    <strong>{{ property.title }}</strong>
                    <div class="meta">
                        <span>{{ property.rooms }} –∫–æ–º–Ω.</span>
                        <span>{{ property.total_area|floatformat:"0" }} –º¬≤</span>
                        <span class="price">{{ property.price|floatformat:"0" }} ‚ÇΩ</span>
                    </div>
                    <div class="card-actions">
                        <a href="{% if user.is_authenticated %}{% url 'properties:property-detail' property.id %}{% else %}{% url 'register' %}?next={% url 'properties:property-detail' property.id %}{% endif %}" class="btn btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>

                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

                <!-- Developers Panel -->
                <div class="panel" id="panel-developers">
                    <div class="grid">
                        <div class="col-6">
                            <div class="card-spot">
                                <div class="media"></div>
                                <div class="content">
                                    <div>
                                        <div class="pill">–ù–æ–≤—ã–µ –ñ–ö</div>
                                        <h3 style="margin:8px 0 6px">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–æ–≤</h3>
                                        <div class="muted">–ò–ø–æ—Ç–µ–∫–∞, —Ä–∞—Å—Å—Ä–æ—á–∫–∞, –∞–∫—Ü–∏–∏</div>
                                    </div>
                                    <a href="{% if user.is_authenticated %}{% url 'developer-list' %}{% else %}{% url 'register' %}?next={% url 'developer-list' %}{% endif %}" class="btn btn-primary">–ö–∞—Ç–∞–ª–æ–≥</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="grid">
                                {% for developer in featured_developers|slice:":2" %}
                                <div class="col-6">
                                    <div class="listing-card">
                                        <div class="thumb">{{ developer.name }}</div>
                                        <div class="body">
                                            <strong>{{ developer.name }}</strong>
                                            <div class="meta"><span>–°–¥–∞—á–∞: {{ developer.completion_date|date:"Y" }}</span><span class="price">–æ—Ç {{ developer.min_price|floatformat:"0" }} –º–ª–Ω ‚ÇΩ</span></div>
                                            <div class="card-actions">
                                                <a href="{% if user.is_authenticated %}{% url 'developer-detail' developer.id %}{% else %}{% url 'register' %}?next={% url 'developer-detail' developer.id %}{% endif %}" class="btn btn-ghost">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                                <a href="{% if user.is_authenticated %}{% url 'developer-detail' developer.id %}#contact{% else %}{% url 'register' %}?next={% url 'developer-detail' developer.id %}#contact{% endif %}" class="btn btn-primary">–°–≤—è–∑–∞—Ç—å—Å—è</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

<!-- Media Panel -->
<div class="panel" id="panel-media">
    <div class="card-spot" style="margin-bottom: 16px">
        <div class="media"></div>
        <div class="content">
            <div>
                <div class="pill">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                <h3 style="margin:8px 0 6px">–õ—É—á—à–∏–µ –≤–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã, —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                <div class="muted">–í—Å–µ –º–µ–¥–∏–∞–º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
            </div>
            <a href="{% url 'media_content:list' %}" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</a>
        </div>
    </div>

    <!-- Inner media tabs -->
    <div class="media-tabs">
        <input type="radio" id="mtab-1" name="mtabs" checked>
        <label for="mtab-1">–í–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã</label>
        <input type="radio" id="mtab-2" name="mtabs">
        <label for="mtab-2">–§–æ—Ç–æ–æ—Ç—á—ë—Ç—ã</label>
        <input type="radio" id="mtab-3" name="mtabs">
        <label for="mtab-3">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</label>

        <div class="media-grid">
        <!-- Videos -->
<!-- Videos -->
<div class="grid" id="mgrid-1">
    {% for media in featured_media %}
    {% if media.media_type == 'video' %}
    <div class="col-4">
        <a href="{% url 'media_content:detail' media.id %}" class="link">
            <article class="media-card">
                <div class="thumb">
                    {% if media.thumbnail_url %}
                        <img src="{{ media.thumbnail_url }}" alt="{{ media.title }}">
                    {% elif media.is_external_video %}
                        <div style="background: linear-gradient(135deg, #7c66ff, #30d0ff);">
                            üìπ –í–∏–¥–µ–æ
                        </div>
                    {% else %}
                        <div style="background: linear-gradient(135deg, #7c66ff, #30d0ff);">
                            {{ media.title }}
                        </div>
                    {% endif %}
                </div>
                <div class="body">
                    <strong>{{ media.title }}</strong>
                    <div class="meta">
                        <span>{{ media.duration|default:"" }}</span>
                    </div>
                </div>
            </article>
        </a>
    </div>
    {% endif %}
    {% empty %}
    <div class="col-12">
        <p class="muted" style="text-align: center; padding: 20px;">–í–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
    </div>
    {% endfor %}
</div>

<!-- Photos -->
<!-- Photos -->
<div class="grid" id="mgrid-2">
    {% for media in featured_media %}
    {% if media.media_type == 'photo' %}
    <div class="col-3">
        <a href="{% url 'media_content:detail' media.id %}" class="link">
            <article class="media-card">
                <div class="thumb">
                    {% if media.thumbnail_url %}
                        <img src="{{ media.thumbnail_url }}" alt="{{ media.title }}">
                    {% elif media.file_url %}
                        <img src="{{ media.file_url }}" alt="{{ media.title }}">
                    {% else %}
                        <div style="background: linear-gradient(135deg, #ff6a3d, #ffba3b);">
                            üì∑ –§–æ—Ç–æ
                        </div>
                    {% endif %}
                </div>
                <div class="body">
                    <strong>{{ media.title }}</strong>
                    <div class="meta"><span>–§–æ—Ç–æ–æ—Ç—á—ë—Ç</span></div>
                </div>
            </article>
        </a>
    </div>
    {% endif %}
    {% empty %}
    <div class="col-12">
        <p class="muted" style="text-align: center; padding: 20px;">–§–æ—Ç–æ–æ—Ç—á—ë—Ç—ã –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
    </div>
    {% endfor %}
</div>

<!-- Analytics -->
<div class="grid" id="mgrid-3">
    {% for media in featured_media %}
    {% if media.media_type == 'article' %}
    <div class="col-6">
        <a href="{% url 'media_content:detail' media.id %}" class="link">
            <article class="media-card">
                <div class="thumb">
                    {% if media.thumbnail_url %}
                        <img src="{{ media.thumbnail_url }}" alt="{{ media.title }}">
                    {% else %}
                        <div style="background: linear-gradient(135deg, #51d67b, #30d0ff);">
                            üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                        </div>
                    {% endif %}
                </div>
                <div class="body">
                    <strong>{{ media.title }}</strong>
                    <div class="meta">
                        <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                        <span>{{ media.reading_time|default:"5" }} –º–∏–Ω —á—Ç–µ–Ω–∏—è</span>
                    </div>
                </div>
            </article>
        </a>
    </div>
    {% endif %}
    {% empty %}
    <div class="col-12">
        <p class="muted" style="text-align: center; padding: 20px;">–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
    </div>
    {% endfor %}
</div>
        </div>
    </div>
</div>
            </div>
        </div>
    </div>
</section>



<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div id="filters-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">–£—Ç–æ—á–Ω–∏—Ç—å –ø–æ–∏—Å–∫</h3>
            <button id="close-filters" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                <select name="property_type" class="w-full p-2 border rounded">
                    <option value="">–õ—é–±–æ–π</option>
                    <option value="new_flat">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞</option>
                    <option value="resale_flat">–í—Ç–æ—Ä–∏—á–∫–∞</option>
                    <option value="house">–î–æ–º</option>
                    <option value="commercial">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">–¶–µ–Ω–∞, –º–ª–Ω ‚ÇΩ</label>
                <div class="flex space-x-2">
                    <input type="number" name="min_price" placeholder="–û—Ç" class="w-1/2 p-2 border rounded">
                    <input type="number" name="max_price" placeholder="–î–æ" class="w-1/2 p-2 border rounded">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">–ü–ª–æ—â–∞–¥—å, –º¬≤</label>
                <div class="flex space-x-2">
                    <input type="number" name="min_area" placeholder="–û—Ç" class="w-1/2 p-2 border rounded">
                    <input type="number" name="max_area" placeholder="–î–æ" class="w-1/2 p-2 border rounded">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                <div class="flex space-x-2">
                    <input type="number" name="rooms__gte" placeholder="–û—Ç" class="w-1/2 p-2 border rounded">
                    <input type="number" name="rooms__lte" placeholder="–î–æ" class="w-1/2 p-2 border rounded">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">–≠—Ç–∞–∂</label>
                <div class="flex space-x-2">
                    <input type="number" name="min_floor" placeholder="–û—Ç" class="w-1/2 p-2 border rounded">
                    <input type="number" name="max_floor" placeholder="–î–æ" class="w-1/2 p-2 border rounded">
                </div>
            </div>

            <button type="button" id="apply-filters" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </button>
        </div>
    </div>
</div>

<script>
// JavaScript –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ home.html –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('location-search');
    const suggestionsContainer = document.getElementById('search-suggestions');
    const geolocationBtn = document.getElementById('geolocation-btn');
    const geoCoordsInput = document.getElementById('geo-coords');
    const showFiltersBtn = document.getElementById('show-filters');
    const filtersModal = document.getElementById('filters-modal');
    const closeFiltersBtn = document.getElementById('close-filters');
    const applyFiltersBtn = document.getElementById('apply-filters');

    // –¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    const propertyTypes = {
        '–∫–≤–∞—Ä—Ç–∏—Ä–∞': ['new_flat', 'resale_flat'],
        '—Å—Ç—É–¥–∏—è': 'studio',
        '–¥–æ–º': 'house',
        '–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è': 'commercial',
        '–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞': 'new_flat',
        '–≤—Ç–æ—Ä–∏—á–∫–∞': 'resale_flat'
    };

    // –ì–æ—Ä–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    const cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å',
                   '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–ß–µ–ª—è–±–∏–Ω—Å–∫', '–°–∞–º–∞—Ä–∞', '–û–º—Å–∫', '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É', '–ú–∞–≥–∞–¥–∞–Ω'];

    // –¢–∏–ø—ã —Å–¥–µ–ª–æ–∫
    const dealTypes = {
        '–∞—Ä–µ–Ω–¥–∞': ['monthly', 'daily'],
        '—Å–Ω—è—Ç—å': ['monthly', 'daily'],
        '–∫—É–ø–∏—Ç—å': 'no',
        '–ø—Ä–æ–¥–∞–∂–∞': 'no'
    };

    // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();

        if (query.length < 2) {
            suggestionsContainer.classList.add('hidden');
            return;
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
        let suggestions = '';

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø–∞–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        Object.keys(propertyTypes).forEach(type => {
            if (type.toLowerCase().includes(query.toLowerCase())) {
                suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                                data-type="${type}">${type}</div>`;
            }
        });

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º
        cities.forEach(city => {
            if (city.toLowerCase().includes(query.toLowerCase())) {
                suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                                data-city="${city}">${city}</div>`;
            }
        });

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Å–¥–µ–ª–æ–∫
        Object.keys(dealTypes).forEach(deal => {
            if (deal.toLowerCase().includes(query.toLowerCase())) {
                suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                                data-deal="${deal}">${deal}</div>`;
            }
        });

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
        if (/—Ü–µ–Ω–∞\s*\d*/i.test(query)) {
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="—Ü–µ–Ω–∞ 5-10 –º–ª–Ω">—Ü–µ–Ω–∞ 5-10 –º–ª–Ω</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="—Ü–µ–Ω–∞ –¥–æ 5 –º–ª–Ω">—Ü–µ–Ω–∞ –¥–æ 5 –º–ª–Ω</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="—Ü–µ–Ω–∞ –æ—Ç 10 –º–ª–Ω">—Ü–µ–Ω–∞ –æ—Ç 10 –º–ª–Ω</div>`;
        }

        if (/–ø–ª–æ—â–∞–¥—å\s*\d*/i.test(query)) {
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="–ø–ª–æ—â–∞–¥—å 50-70 –º¬≤">–ø–ª–æ—â–∞–¥—å 50-70 –º¬≤</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="–ø–ª–æ—â–∞–¥—å –æ—Ç 80 –º¬≤">–ø–ª–æ—â–∞–¥—å –æ—Ç 80 –º¬≤</div>`;
        }

        if (query.toLowerCase().includes('—Ä—è–¥–æ–º') || query.toLowerCase().includes('–Ω–µ–¥–∞–ª–µ–∫–æ')) {
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-geo="true">—Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π</div>`;
        }

        if (query.toLowerCase().includes('–∫–æ–º–Ω–∞—Ç')) {
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è">1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è">2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è">3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="4-–∫–æ–º–Ω–∞—Ç–Ω–∞—è">4-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>`;
            suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                            data-query="5-–∫–æ–º–Ω–∞—Ç–Ω–∞—è">5-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>`;
        }

        // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
        if (query.toLowerCase().includes('–∫–≤–∞—Ä—Ç–∏—Ä–∞') || query.toLowerCase().includes('—Å—Ç—É–¥–∏—è') || query.toLowerCase().includes('–¥–æ–º')) {
            cities.forEach(city => {
                const type = query.split(' ')[0].toLowerCase();
                if (propertyTypes[type]) {
                    suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                                    data-combined="${type} ${city}">${type} –≤ ${city}</div>`;
                }
            });
        }

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–∏–ø–∞ "2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ –ú–æ—Å–∫–≤–µ"
        const roomMatch = query.match(/(\d+)-–∫–æ–º–Ω–∞—Ç–Ω–∞—è/i);
        if (roomMatch) {
            cities.forEach(city => {
                suggestions += `<div class="p-3 hover:bg-gray-100 cursor-pointer"
                                data-combined="${roomMatch[1]} ${city}">${roomMatch[0]} –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ ${city}</div>`;
            });
        }

        if (suggestions) {
            suggestionsContainer.innerHTML = suggestions;
            suggestionsContainer.classList.remove('hidden');
        } else {
            suggestionsContainer.classList.add('hidden');
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    suggestionsContainer.addEventListener('click', function(e) {
        if (e.target.dataset.type) {
            searchInput.value = e.target.textContent;
            addHiddenInput('property_type', propertyTypes[e.target.dataset.type]);
        }
        else if (e.target.dataset.city) {
            searchInput.value = e.target.dataset.city;
            addHiddenInput('location', e.target.dataset.city);
        }
        else if (e.target.dataset.deal) {
            searchInput.value = e.target.textContent;
            addHiddenInput('is_rental', dealTypes[e.target.dataset.deal]);
        }
        else if (e.target.dataset.query) {
            searchInput.value = e.target.dataset.query;
        }
        else if (e.target.dataset.geo) {
            searchInput.value = '—Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π';
            getGeolocation();
        }
        else if (e.target.dataset.combined) {
            const parts = e.target.dataset.combined.split(' ');
            if (parts.length === 2) {
                const [type, city] = parts;
                searchInput.value = `${type} –≤ ${city}`;
                if (propertyTypes[type]) {
                    addHiddenInput('property_type', propertyTypes[type]);
                }
                addHiddenInput('location', city);
            } else if (parts.length === 3) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ "2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –ú–æ—Å–∫–≤–∞"
                const rooms = parts[0];
                const city = parts[1];
                searchInput.value = `${rooms}-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ ${city}`;
                addHiddenInput('rooms', rooms);
                addHiddenInput('location', city);
                addHiddenInput('property_type', 'new_flat,resale_flat');
            }
        }

        suggestionsContainer.classList.add('hidden');
    });

    // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
    geolocationBtn.addEventListener('click', getGeolocation);

    function getGeolocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                position => {
                    const coords = `${position.coords.latitude},${position.coords.longitude},5`;
                    geoCoordsInput.value = coords;
                    searchInput.value = '—Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π';
                    showToast('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞', 'success');
                },
                error => {
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'error');
                    console.error('Geolocation error:', error);
                }
            );
        } else {
            showToast('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é', 'error');
        }
    }

    // –§–∏–ª—å—Ç—Ä—ã
    showFiltersBtn.addEventListener('click', function() {
        filtersModal.classList.remove('hidden');
    });

    closeFiltersBtn.addEventListener('click', function() {
        filtersModal.classList.add('hidden');
    });

    applyFiltersBtn.addEventListener('click', function() {
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –∫ —Ñ–æ—Ä–º–µ
        const filters = filtersModal.querySelectorAll('select, input[type="number"]');
        filters.forEach(filter => {
            if (filter.value) {
                const existing = searchForm.querySelector(`[name="${filter.name}"]`);
                if (existing) existing.remove();

                const clone = filter.cloneNode();
                clone.value = filter.value;
                searchForm.appendChild(clone);
            }
        });

        filtersModal.classList.add('hidden');
        searchForm.submit();
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const searchValue = searchInput.value.trim();

        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
        const hiddenInputs = searchForm.querySelectorAll('input[type="hidden"]');
        hiddenInputs.forEach(input => {
            if (!['radius_filter'].includes(input.name)) {
                input.remove();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–∏–ø–∞ "2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ –ú–æ—Å–∫–≤–µ"
        const roomsMatch = searchValue.match(/(\d+)\s*-?\s*–∫–æ–º–Ω–∞—Ç–Ω(–∞—è|—ã–µ|—É—é|–æ–π)/i);
        if (roomsMatch) {
            addHiddenInput('rooms', roomsMatch[1]);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        const typeMatch = searchValue.match(/(–∫–≤–∞—Ä—Ç–∏—Ä[–∞—É–µ—ã]|—Å—Ç—É–¥–∏[—é—è]|–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç[—ã–∞]|–¥–æ–º|–∫–æ–º–º–µ—Ä—á–µ—Å–∫[–∞—è–æ–π]|–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫[–∞–∏]|–≤—Ç–æ—Ä–∏—á–∫[–∞—É])/i);
        if (typeMatch) {
            const typeKey = typeMatch[1].toLowerCase();
            if (typeKey.startsWith('–∫–≤–∞—Ä—Ç–∏—Ä') || typeKey.startsWith('–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç')) {
                addHiddenInput('property_type', 'new_flat,resale_flat');
            } else if (typeKey.startsWith('—Å—Ç—É–¥–∏')) {
                addHiddenInput('apartment_type', 'studio');
            } else if (typeKey.startsWith('–¥–æ–º')) {
                addHiddenInput('property_type', 'house');
            } else if (typeKey.startsWith('–∫–æ–º–º–µ—Ä—á–µ—Å–∫')) {
                addHiddenInput('property_type', 'commercial');
            } else if (typeKey.startsWith('–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫')) {
                addHiddenInput('property_type', 'new_flat');
            } else if (typeKey.startsWith('–≤—Ç–æ—Ä–∏—á–∫')) {
                addHiddenInput('property_type', 'resale_flat');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ä–æ–¥–∞
        const cityMatch = searchValue.match(/(–≤|–Ω–∞)\s+(–º–æ—Å–∫–≤[–µ—É]|—Å–∞–Ω–∫—Ç\s*-?\s*–ø–µ—Ç–µ—Ä–±—É—Ä–≥[–µ]|—Å–ø–±|–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥[–µ]|–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫[–µ]|–∫–∞–∑–∞–Ω[–∏]|–Ω–∏–∂–Ω[–µ–∏–π][–π–º]\s*–Ω–æ–≤–≥–æ—Ä–æ–¥[–µ]|—Å–∞–º–∞—Ä[–µ]|–æ–º—Å–∫[–µ]|—á–µ–ª—è–±–∏–Ω—Å–∫[–µ]|—Ä–æ—Å—Ç–æ–≤[–µ]\s*-?\s*–Ω–∞\s*-?\s*–¥–æ–Ω—É|—É—Ñ[–µ]|–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫[–µ]|–ø–µ—Ä–º[–∏]|–≤–æ—Ä–æ–Ω–µ–∂[–µ]|–≤–æ–ª–≥–æ–≥—Ä–∞–¥[–µ]|–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä[–µ]|—Å–æ—á–∏|–ø–æ–¥–æ–ª—å—Å–∫|–º—ã—Ç–∏—â|–±–∞–ª–∞—à–∏—Ö|–ª—é–±–µ—Ä—Ü|—Ö–∏–º–∫|–∑–µ–ª–µ–Ω–æ–≥—Ä–∞–¥|–º–∞–≥–∞–¥–∞–Ω[–µ])/i);
        if (cityMatch) {
            const cityKey = cityMatch[2].toLowerCase();
            let city = '';

            if (cityKey.startsWith('–º–æ—Å–∫–≤')) city = '–ú–æ—Å–∫–≤–∞';
            else if (cityKey.startsWith('—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥') || cityKey.startsWith('—Å–ø–±')) city = '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥';
            else if (cityKey.startsWith('–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥')) city = '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥';
            else if (cityKey.startsWith('–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫')) city = '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫';
            else if (cityKey.startsWith('–∫–∞–∑–∞–Ω')) city = '–ö–∞–∑–∞–Ω—å';
            else if (cityKey.startsWith('–Ω–∏–∂–Ω') && cityKey.includes('–Ω–æ–≤–≥–æ—Ä–æ–¥')) city = '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥';
            else if (cityKey.startsWith('—Å–∞–º–∞—Ä')) city = '–°–∞–º–∞—Ä–∞';
            else if (cityKey.startsWith('–æ–º—Å–∫')) city = '–û–º—Å–∫';
            else if (cityKey.startsWith('—á–µ–ª—è–±–∏–Ω—Å–∫')) city = '–ß–µ–ª—è–±–∏–Ω—Å–∫';
            else if (cityKey.startsWith('—Ä–æ—Å—Ç–æ–≤') && cityKey.includes('–¥–æ–Ω—É')) city = '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É';
            else if (cityKey.startsWith('—É—Ñ')) city = '–£—Ñ–∞';
            else if (cityKey.startsWith('–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫')) city = '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫';
            else if (cityKey.startsWith('–ø–µ—Ä–º')) city = '–ü–µ—Ä–º—å';
            else if (cityKey.startsWith('–≤–æ—Ä–æ–Ω–µ–∂')) city = '–í–æ—Ä–æ–Ω–µ–∂';
            else if (cityKey.startsWith('–≤–æ–ª–≥–æ–≥—Ä–∞–¥')) city = '–í–æ–ª–≥–æ–≥—Ä–∞–¥';
            else if (cityKey.startsWith('–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä')) city = '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä';
            else if (cityKey.startsWith('—Å–æ—á–∏')) city = '–°–æ—á–∏';
            else if (cityKey.startsWith('–º–∞–≥–∞–¥–∞–Ω')) city = '–ú–∞–≥–∞–¥–∞–Ω';

            if (city) {
                addHiddenInput('location', city);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–∞ —Å–¥–µ–ª–∫–∏ (–∞—Ä–µ–Ω–¥–∞/–ø–æ–∫—É–ø–∫–∞)
        const rentMatch = searchValue.match(/(—Å–Ω—è—Ç—å|–∞—Ä–µ–Ω–¥[–∞—É–µ—ã]|–ø–æ—Å—É—Ç–æ—á–Ω[–∞—è–æ–π]|–ø–æ–º–µ—Å—è—á–Ω[–∞—è–æ–π])/i);
        const buyMatch = searchValue.match(/(–∫—É–ø[–∏–∏—Ç—å]|–ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏|–ø—Ä–æ–¥–∞–∂[–∞–µ]|–ø–æ–∫—É–ø–∫[–∞–µ])/i);

        if (rentMatch) {
            addHiddenInput('is_rental', 'monthly,daily');
        } else if (buyMatch) {
            addHiddenInput('is_rental', 'no');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–Ω—ã
        const priceMatch = searchValue.match(/(—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å)\s*(–æ—Ç|–¥–æ)?\s*(\d+)\s*(–º–ª–Ω|—Ç—ã—Å|—Ç\.?—Ä|—Ä\.?)/i);
        if (priceMatch) {
            let amount = parseFloat(priceMatch[3]);
            const unit = priceMatch[4];

            if (unit.includes('–º–ª–Ω')) amount *= 1000000;
            else if (unit.includes('—Ç—ã—Å')) amount *= 1000;

            if (priceMatch[2] === '–æ—Ç') {
                addHiddenInput('min_price', amount);
            } else if (priceMatch[2] === '–¥–æ') {
                addHiddenInput('max_price', amount);
            } else {
                // –ü—Ä–∏–º–µ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (+-20%)
                addHiddenInput('min_price', amount * 0.8);
                addHiddenInput('max_price', amount * 1.2);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–æ—â–∞–¥–∏
        const areaMatch = searchValue.match(/(–ø–ª–æ—â–∞–¥—å|–ø–ª–æ—â–∞–¥—å—é|–º–µ—Ç—Ä–∞–∂)\s*(\d+)\s*-?\s*(\d+)?\s*(–º|–º¬≤|–∫–≤\.?\s*–º)/i);
        if (areaMatch) {
            const minArea = parseFloat(areaMatch[2]);
            const maxArea = areaMatch[3] ? parseFloat(areaMatch[3]) : minArea;
            addHiddenInput('min_area', minArea);
            addHiddenInput('max_area', maxArea);
        }

        // –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å "—Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π" –∏ –µ—Å—Ç—å –≥–µ–æ–¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä —Ä–∞–¥–∏—É—Å–∞
        if ((searchValue.toLowerCase().includes('—Ä—è–¥–æ–º') ||
             searchValue.toLowerCase().includes('–Ω–µ–¥–∞–ª–µ–∫–æ'))) {
            if (geoCoordsInput.value) {
                // –§–∏–ª—å—Ç—Ä —Ä–∞–¥–∏—É—Å–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ geoCoordsInput
            } else {
                getGeolocation();
                return; // –ñ–¥–µ–º –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
            }
        }

        this.submit();
    });

    function addHiddenInput(name, value) {
        const existing = searchForm.querySelector(`input[name="${name}"]`);
        if (existing) existing.remove();

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        searchForm.appendChild(input);
    }

    function showToast(message, type) {
        const toast = document.createElement('div');
        toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg text-white ${
            type === 'success' ? 'bg-green-500' : 'bg-red-500'
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
});
</script>
{% endblock %}