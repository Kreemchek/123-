{% extends 'base.html' %}
{% load widget_tweaks %}
{% block title %}WinWinDeal{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Заголовок -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Выберите своего брокера</h1>
        <p class="text-gray-600 mt-2">Найдите идеального специалиста для ваших нужд</p>
    </div>

    <!-- Мобильная кнопка открытия фильтров -->
    <div class="lg:hidden mb-4">
        <button class="w-full bg-gradient-to-r from-[#7b61ff] to-[#36d1dc] text-white py-3 px-4 rounded-lg hover:shadow-lg transition-all font-medium flex items-center justify-center" id="mobile-filters-btn">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
            Фильтры
            {% if request.GET.search or request.GET.rating or request.GET.experience or request.GET.services or request.GET.specialization %}
            <span class="ml-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">!</span>
            {% endif %}
        </button>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Боковая панель с фильтрами (десктоп) -->
        <div class="lg:w-1/4 hidden lg:block">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 sticky top-6">
                <!-- Форма фильтров (встроенная вместо include) -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Фильтры</h2>
                    <a href="{% url 'broker-list' %}" class="text-sm" style="background: linear-gradient(135deg, #7b61ff, #36d1dc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        Сбросить все
                    </a>
                </div>

                <form method="get" class="space-y-6">
                    <!-- Поиск по имени -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Поиск по имени</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </span>
                            <input type="text" name="search" value="{{ request.GET.search }}"
                                   class="pl-10 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent"
                                   style="focus:ring: linear-gradient(135deg, #7b61ff, #36d1dc);"
                                   placeholder="Введите имя...">
                        </div>
                    </div>

                    <!-- Рейтинг -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Минимальный рейтинг</label>
                        <div class="flex items-center space-x-2">
                            <input type="range" name="rating" min="0" max="5" step="0.5"
                                   value="{{ request.GET.rating|default:'0' }}"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                   id="ratingSlider">
                            <span id="ratingValue" class="text-sm font-medium text-gray-700 w-10 text-center">
                                {{ request.GET.rating|default:'0' }}
                            </span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>0</span>
                            <span class="flex items-center">
                                <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                5
                            </span>
                        </div>
                    </div>

                    <!-- Опыт работы -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Опыт работы</label>
                        <select name="experience" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent"
                                style="focus:ring: linear-gradient(135deg, #7b61ff, #36d1dc);">
                            <option value="">Все уровни опыта</option>
                            <option value="0-2" {% if request.GET.experience == "0-2" %}selected{% endif %}>Менее 2 лет</option>
                            <option value="2-5" {% if request.GET.experience == "2-5" %}selected{% endif %}>2-5 лет</option>
                            <option value="5-10" {% if request.GET.experience == "5-10" %}selected{% endif %}>5-10 лет</option>
                            <option value="10+" {% if request.GET.experience == "10+" %}selected{% endif %}>Более 10 лет</option>
                        </select>
                    </div>

                    <!-- Услуги -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-3 flex items-center justify-between">
                            <span>Услуги</span>
                            <span class="text-xs text-gray-500 font-normal">Выберите одну или несколько</span>
                        </h3>
                        <div class="space-y-2">
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="services" value="consultation"
                                       {% if "consultation" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Консультации</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="services" value="selection"
                                       {% if "selection" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Подбор объекта</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="services" value="transaction"
                                       {% if "transaction" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Проведение сделок</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="services" value="legal"
                                       {% if "legal" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Юридическое сопровождение</span>
                            </label>
                        </div>
                    </div>

                    <!-- Специализация -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-3 flex items-center justify-between">
                            <span>Специализация</span>
                            <span class="text-xs text-gray-500 font-normal">Выберите одну или несколько</span>
                        </h3>
                        <div class="space-y-2">
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="specialization" value="residential"
                                       {% if "residential" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Жилая недвижимость</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="specialization" value="commercial"
                                       {% if "commercial" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Коммерческая недвижимость</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="specialization" value="country"
                                       {% if "country" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Загородная недвижимость</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="specialization" value="rent"
                                       {% if "rent" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Аренда</span>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="specialization" value="mortgage"
                                       {% if "mortgage" in request.GET.getlist %}checked{% endif %}
                                       class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                       style="accent-color: #7b61ff;">
                                <span class="ml-3 text-sm text-gray-700">Ипотека</span>
                            </label>
                        </div>
                    </div>

                    <!-- Кнопка применения фильтров -->
<button type="submit"
        style="background: linear-gradient(135deg, #7b61ff, #36d1dc); color: white; border: none; border-radius: 0.5rem; padding: 0.75rem 1rem; font-weight: 500; width: 100%; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(123, 97, 255, 0.3)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
    </svg>
    Применить фильтры
</button>
                </form>
            </div>
        </div>

        <!-- Мобильное меню фильтров -->
        <div class="mobile-catalog-dropdown lg:hidden fixed top-0 left-0 right-0 bottom-0 bg-white z-50 overflow-y-auto transform -translate-x-full transition-transform duration-300" id="mobile-filters-dropdown">
            <div class="sticky top-0 bg-white border-b border-gray-200 z-10">
                <div class="flex justify-between items-center p-4">
                    <h2 class="text-xl font-semibold text-gray-900">Фильтры</h2>
<button type="submit"
        style="background: linear-gradient(135deg, #7b61ff, #36d1dc); color: white; border: none; border-radius: 0.5rem; padding: 0.75rem 1rem; font-weight: 500; flex: 1; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(123, 97, 255, 0.3)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
    Применить
</button>
                </div>
            </div>

            <div class="p-4">
                <!-- Мобильная форма фильтров -->
                <form method="get" class="space-y-6">
                    <!-- Поиск по имени -->
                    <div class="mobile-filter-section">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-medium text-gray-900">Поиск по имени</span>
                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                        </div>
                        <div class="mobile-filter-content pt-3" style="display: none;">
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </span>
                                <input type="text" name="search" value="{{ request.GET.search }}"
                                       class="pl-10 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent"
                                       style="focus:ring: linear-gradient(135deg, #7b61ff, #36d1dc);"
                                       placeholder="Введите имя...">
                            </div>
                        </div>
                    </div>

                    <!-- Рейтинг -->
                    <div class="mobile-filter-section">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-medium text-gray-900">Рейтинг</span>
                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                        </div>
                        <div class="mobile-filter-content pt-3" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Минимальный рейтинг</label>
                            <div class="flex items-center space-x-2">
                                <input type="range" name="rating" min="0" max="5" step="0.5"
                                       value="{{ request.GET.rating|default:'0' }}"
                                       class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                       id="ratingSliderMobile">
                                <span id="ratingValueMobile" class="text-sm font-medium text-gray-700 w-10 text-center">
                                    {{ request.GET.rating|default:'0' }}
                                </span>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0</span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                    5
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Опыт работы -->
                    <div class="mobile-filter-section">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-medium text-gray-900">Опыт работы</span>
                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                        </div>
                        <div class="mobile-filter-content pt-3" style="display: none;">
                            <select name="experience" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent"
                                    style="focus:ring: linear-gradient(135deg, #7b61ff, #36d1dc);">
                                <option value="">Все уровни опыта</option>
                                <option value="0-2" {% if request.GET.experience == "0-2" %}selected{% endif %}>Менее 2 лет</option>
                                <option value="2-5" {% if request.GET.experience == "2-5" %}selected{% endif %}>2-5 лет</option>
                                <option value="5-10" {% if request.GET.experience == "5-10" %}selected{% endif %}>5-10 лет</option>
                                <option value="10+" {% if request.GET.experience == "10+" %}selected{% endif %}>Более 10 лет</option>
                            </select>
                        </div>
                    </div>

                    <!-- Услуги -->
                    <div class="mobile-filter-section">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-medium text-gray-900">Услуги</span>
                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                        </div>
                        <div class="mobile-filter-content pt-3" style="display: none;">
                            <div class="space-y-2">
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="services" value="consultation"
                                           {% if "consultation" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Консультации</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="services" value="selection"
                                           {% if "selection" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Подбор объекта</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="services" value="transaction"
                                           {% if "transaction" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Проведение сделок</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="services" value="legal"
                                           {% if "legal" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Юридическое сопровождение</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Специализация -->
                    <div class="mobile-filter-section">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-medium text-gray-900">Специализация</span>
                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                        </div>
                        <div class="mobile-filter-content pt-3" style="display: none;">
                            <div class="space-y-2">
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="specialization" value="residential"
                                           {% if "residential" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Жилая недвижимость</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="specialization" value="commercial"
                                           {% if "commercial" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Коммерческая недвижимость</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="specialization" value="country"
                                           {% if "country" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Загородная недвижимость</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="specialization" value="rent"
                                           {% if "rent" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Аренда</span>
                                </label>
                                <label class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="specialization" value="mortgage"
                                           {% if "mortgage" in request.GET.getlist %}checked{% endif %}
                                           class="rounded border-gray-300 focus:ring-2 focus:ring-offset-1"
                                           style="accent-color: #7b61ff;">
                                    <span class="ml-3 text-sm text-gray-700">Ипотека</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Кнопки действий -->
                    <div class="sticky bottom-0 bg-white pt-4 pb-6 border-t border-gray-200 mt-6">
                        <div class="flex gap-3">
                            <a href="{% url 'broker-list' %}" class="flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors font-medium text-center">
                                Сбросить
                            </a>
                            <button type="submit" class="flex-1 bg-gradient-to-r from-[#7b61ff] to-[#36d1dc] text-white py-3 px-4 rounded-lg hover:shadow-lg transition-all font-medium flex items-center justify-center">
                                Применить
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Оверлей для мобильного меню -->
        <div class="overlay lg:hidden" id="mobile-filters-overlay" style="display: none;"></div>

        <!-- Основной контент -->
        <div class="lg:w-3/4">
            <!-- Статистика и сортировка -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6 flex flex-col sm:flex-row justify-between items-center">
                <p class="text-gray-600 text-sm mb-2 sm:mb-0">
                    Найдено <span class="font-semibold">{{ brokers.count }}</span> брокеров
                </p>
                <div class="flex items-center">
                    <span class="text-sm text-gray-600 mr-2">Сортировка:</span>
                    <select class="text-sm border border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:border-transparent"
                            style="focus:ring: linear-gradient(135deg, #7b61ff, #36d1dc);">
                        <option>По рейтингу</option>
                        <option>По опыту</option>
                        <option>По имени</option>
                    </select>
                </div>
            </div>

            <!-- Список брокеров -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for broker in brokers %}
                <div class="bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 border border-gray-100 overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-start space-x-4">
                            <!-- Аватар -->
                            <div class="flex-shrink-0">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-r from-[#7b61ff] to-[#36d1dc] flex items-center justify-center border-2 border-white shadow-md overflow-hidden">
                                    {% if broker.user.avatar %}
                                        <img src="{{ broker.user.avatar.url }}" class="w-full h-full object-cover">
                                    {% else %}
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                        </svg>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Информация -->
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between">
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 truncate">{{ broker.user.get_full_name }}</h3>

                                        <!-- Рейтинг -->
                                        <div class="flex items-center mt-1">
                                            <div class="flex items-center">
                                                {% with rating=broker.rating|default:0 %}
                                                {% for i in "12345"|make_list %}
                                                    {% if forloop.counter <= rating %}
                                                        <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                        </svg>
                                                    {% else %}
                                                        <svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                        </svg>
                                                    {% endif %}
                                                {% endfor %}
                                                {% endwith %}
                                            </div>
                                            <span class="ml-1 text-sm text-gray-600">{{ broker.rating|default:"0.0" }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Специализация -->
                                {% if broker.specializations %}
                                <p class="text-sm font-medium mt-2" style="background: linear-gradient(135deg, #7b61ff, #36d1dc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                    {% for spec in broker.get_specializations_display %}
                                        {% if forloop.first %}{{ spec }}{% endif %}
                                    {% endfor %}
                                    {% if broker.specializations|length > 1 %} +{{ broker.specializations|length|add:"-1" }}{% endif %}
                                </p>
                                {% endif %}

                                <!-- Опыт -->
                                <div class="flex items-center mt-2 text-gray-600 text-sm">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Опыт: {{ broker.experience }} лет
                                </div>

                                <!-- Услуги -->
                                <div class="mt-3 flex flex-wrap gap-1">
                                    {% for service in broker.get_services_display|slice:":3" %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium text-white"
                                          style="background: linear-gradient(135deg, #7b61ff, #36d1dc);">
                                        {{ service }}
                                    </span>
                                    {% endfor %}
                                    {% if broker.services|length > 3 %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        +{{ broker.services|length|add:"-3" }}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Футер карточки -->
                    <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-lg font-bold text-gray-900">
                            {% if broker.hourly_rate %}
                                от {{ broker.hourly_rate }} ₽/час
                            {% else %}
                                Цена по запросу
                            {% endif %}
                        </span>
                        <a href="{% url 'broker-detail' broker.pk %}"
                           class="px-4 py-2 text-white text-sm font-medium rounded-lg hover:shadow-lg transition-all"
                           style="background: linear-gradient(135deg, #7b61ff, #36d1dc);">
                            Подробнее
                        </a>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Брокеры не найдены</h3>
                    <p class="text-gray-500 mb-4">Попробуйте изменить параметры фильтрации</p>
                    <a href="{% url 'broker-list' %}" class="px-6 py-2 text-white rounded-lg hover:shadow-lg transition-all font-medium inline-block"
                       style="background: linear-gradient(135deg, #7b61ff, #36d1dc);">
                        Сбросить фильтры
                    </a>
                </div>
                {% endfor %}
            </div>

            <!-- Пагинация -->
            {% if is_paginated %}
            <div class="mt-8 flex justify-center">
                <nav class="flex items-center space-x-2">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                       class="px-3 py-2 text-gray-500 hover:text-gray-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </a>
                    {% endif %}

                    {% for num in paginator.page_range %}
                        {% if page_obj.number == num %}
                        <span class="px-4 py-2 text-white rounded-lg font-medium"
                              style="background: linear-gradient(135deg, #7b61ff, #36d1dc);">
                            {{ num }}
                        </span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a href="?page={{ num }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                           class="px-4 py-2 text-gray-700 hover:text-white rounded-lg font-medium transition-all hover:shadow-lg"
                           style="hover: background: linear-gradient(135deg, #7b61ff, #36d1dc);">
                            {{ num }}
                        </a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                       class="px-3 py-2 text-gray-500 hover:text-gray-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Стили для градиентного скроллбара */
::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #7b61ff, #36d1dc);
    border-radius: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar {
    width: 8px;
}

/* Анимации для мобильного меню */
.mobile-catalog-dropdown {
    transition: transform 0.3s ease-in-out;
}

.mobile-catalog-dropdown.active {
    transform: translateX(0);
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 40;
}

/* Стилизация ползунка рейтинга */
input[type="range"] {
    -webkit-appearance: none;
    background: linear-gradient(to right, #7b61ff 0%, #36d1dc 100%);
    height: 6px;
    border-radius: 3px;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: white;
    border: 2px solid #7b61ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background: white;
    border: 2px solid #7b61ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* Стили для кнопок с градиентом */
.btn-gradient {
    background: linear-gradient(135deg, #7b61ff, #36d1dc);
    color: white;
    border: none;
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.btn-gradient:hover {
    background: linear-gradient(135deg, #6a50e6, #2bb7c2);
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(123, 97, 255, 0.3);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Мобильное меню фильтров
    const mobileFiltersBtn = document.getElementById('mobile-filters-btn');
    const mobileFiltersDropdown = document.getElementById('mobile-filters-dropdown');
    const mobileFiltersClose = document.getElementById('mobile-filters-close');
    const mobileFiltersOverlay = document.getElementById('mobile-filters-overlay');

    if (mobileFiltersBtn && mobileFiltersDropdown) {
        mobileFiltersBtn.addEventListener('click', function() {
            mobileFiltersDropdown.classList.add('active');
            mobileFiltersDropdown.style.transform = 'translateX(0)';
            mobileFiltersOverlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
        });

        function closeMobileFilters() {
            mobileFiltersDropdown.classList.remove('active');
            mobileFiltersDropdown.style.transform = 'translateX(-100%)';
            mobileFiltersOverlay.style.display = 'none';
            document.body.style.overflow = '';
        }

        if (mobileFiltersClose) {
            mobileFiltersClose.addEventListener('click', closeMobileFilters);
        }

        if (mobileFiltersOverlay) {
            mobileFiltersOverlay.addEventListener('click', closeMobileFilters);
        }
    }

    // Обновление значения рейтинга для десктопного слайдера
    const ratingSlider = document.getElementById('ratingSlider');
    const ratingValue = document.getElementById('ratingValue');

    if (ratingSlider && ratingValue) {
        ratingSlider.addEventListener('input', function() {
            ratingValue.textContent = this.value;
        });
    }

    // Обновление значения рейтинга для мобильного слайдера
    const ratingSliderMobile = document.getElementById('ratingSliderMobile');
    const ratingValueMobile = document.getElementById('ratingValueMobile');

    if (ratingSliderMobile && ratingValueMobile) {
        ratingSliderMobile.addEventListener('input', function() {
            ratingValueMobile.textContent = this.value;
        });
    }

    // Аккордеон для мобильных фильтров
    const mobileFilterSections = document.querySelectorAll('.mobile-filter-section');

    mobileFilterSections.forEach(section => {
        const header = section.querySelector('.flex.justify-between.items-center');
        const content = section.querySelector('.mobile-filter-content');
        const icon = section.querySelector('.fa-chevron-down');

        if (header && content) {
            header.addEventListener('click', function() {
                const isOpen = content.style.display === 'block';

                // Закрываем все секции
                mobileFilterSections.forEach(s => {
                    const c = s.querySelector('.mobile-filter-content');
                    const i = s.querySelector('.fa-chevron-down');
                    if (c) c.style.display = 'none';
                    if (i) i.style.transform = 'rotate(0deg)';
                });

                // Открываем текущую, если была закрыта
                if (!isOpen) {
                    content.style.display = 'block';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }
            });
        }
    });

    // Показываем первую секцию по умолчанию
    const firstSection = document.querySelector('.mobile-filter-section');
    if (firstSection) {
        const firstContent = firstSection.querySelector('.mobile-filter-content');
        const firstIcon = firstSection.querySelector('.fa-chevron-down');
        if (firstContent) firstContent.style.display = 'block';
        if (firstIcon) firstIcon.style.transform = 'rotate(180deg)';
    }
});
</script>
{% endblock %}